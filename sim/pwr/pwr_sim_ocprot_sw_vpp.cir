* gnetlist -g spice-sdb -o pwr_sim_ocprot_sw_vpp.cir pwr_sim_ocprot_sw_vpp.sch
*********************************************************
* Spice file generated by gnetlist                      *
* spice-sdb version 4.28.2007 by SDB --                 *
* provides advanced spice netlisting capability.        *
* Documentation at http://www.brorson.com/gEDA/SPICE/   *
*********************************************************
*vvvvvvvv  Included SPICE model from IRLML9301.cir vvvvvvvv
.SUBCKT irlml9301 1 2 3
* SPICE3 MODEL WITH THERMAL RC NETWORK
**************************************
*      Model Generated by MODPEX     *
*Copyright(c) Symmetry Design Systems*
*         All Rights Reserved        *
*    UNPUBLISHED LICENSED SOFTWARE   *
*   Contains Proprietary Information *
*      Which is The Property of      *
*     SYMMETRY OR ITS LICENSORS      *
*Commercial Use or Resale Restricted *
*   by Symmetry License Agreement    *
**************************************
* Model generated on Sept 02, 10
* MODEL FORMAT: SPICE3
* Symmetry POWER MOS Model (Version 1.0)
* External Node Designations
* Node 1 -> Drain
* Node 2 -> Gate
* Node 3 -> Source
M1 9 7 8 8 MM L=100u W=100u
.MODEL MM PMOS LEVEL=1 IS=1e-32
+VTO=-2.36102 LAMBDA=0.0642611 KP=6.30745
+CGSO=3.35956e-06 CGDO=3.55018e-07
RS 8 3 0.0238912
D1 1 3 MD
.MODEL MD D IS=3.82078e-11 RS=0.0108136 N=1.1398 BV=30
+IBV=0.00025 EG=1.2 XTI=4 TT=1e-07
+CJO=1.15607e-10 VJ=4.96889 M=0.868062 FC=0.468925
RDS 3 1 1e+08
RD 9 1 0.0001
RG 2 7 11.5798
D2 5 4 MD1
* Default values used in MD1:
*   RS=0 EG=1.11 XTI=3.0 TT=0
*   BV=infinite IBV=1mA
.MODEL MD1 D IS=1e-32 N=50
+CJO=3.05781e-10 VJ=0.5 M=0.568348 FC=1e-08
D3 5 0 MD2
* Default values used in MD2:
*   EG=1.11 XTI=3.0 TT=0 CJO=0
*   BV=infinite IBV=1mA
.MODEL MD2 D IS=1e-10 N=0.4005 RS=3e-06
RL 5 10 1
FI2 7 9 VFI2 -1
VFI2 4 0 0
EV16 10 0 9 7 1
CAP 11 10 4.48234e-10
FI1 7 9 VFI1 -1
VFI1 11 6 0
RCAP 6 10 1
D4 6 0 MD3
* Default values used in MD3:
*   EG=1.11 XTI=3.0 TT=0 CJO=0
*   RS=0 BV=infinite IBV=1mA
.MODEL MD3 D IS=1e-10 N=0.4005
.ENDS irlml9301trpbf


*SPICE Thermal Model Subcircuit
.SUBCKT irlml9301trpbft 5 1

R_RTHERM1         5 4  6.0565349
R_RTHERM2         4 3  42.170179
R_RTHERM3         3 2  33.134799
R_RTHERM4         2 1  18.526124
C_CTHERM1         5 1  0.000124
C_CTHERM2         4 1  0.005292
C_CTHERM3         3 1  0.042290
C_CTHERM4         2 1  0.001162

.ENDS irlml9301trpbft



*^^^^^^^^  End of included SPICE model from IRLML9301.cir ^^^^^^^^
*
*vvvvvvvv  Included SPICE model from PDTC114EU.cir vvvvvvvv
*
**********************************************************
*
* PDTC114EU
*
* NXP Semiconductors
*
* Resistor equipped NPN transistor (RET)
* IC   = 100 mA
* VCEO = 50 V
* hFE  = min. 30 @ 5V/5mA
* R1   = 10 Kohm
* R2   = 10 Kohm
*
*
* Package pinning does not match Spice model pinning.
* Package: SOT 323
*
* Package Pin 1: Base
* Package Pin 2: Emitter
* Package Pin 3: Collector
*
*
* Extraction date (week/year): 43/2014
* Simulator: Spice 3
*
**********************************************************
*sb#
* Please note: ---Resistances R1 and R2 are not part of the
* model and have to be added separately.---
* Diode D is dedicated to improve modeling in  reverse
* area of operation and does not reflect a physical device.
*
.SUBCKT PDTC114EU 1 2 3
*
Q1 1 4 3 MAIN
D1 2 1 DIODE
R1 2 4 10K
R2 4 3 10K
.MODEL MAIN NPN
+ IS = 7.342E-015
+ NF = 0.9765
+ ISE = 4.422E-015
+ NE = 1.742
+ BF = 296
+ IKF = 0.1257
+ VAF = 45.06
+ NR = 0.974
+ ISC = 8.521E-016
+ NC = 1.094
+ BR = 17.5
+ IKR = 1
+ VAR = 39
+ RB = 160
+ IRB = 0.000145
+ RBM = 4.2
+ RE = 0.3998
+ RC = 0.5587
+ XTB = 0
+ EG = 1.11
+ XTI = 3
+ CJE = 1.014E-011
+ VJE = 0.67
+ MJE = 0.3454
+ TF = 5.92E-010
+ XTF = 25
+ VTF = 2
+ ITF = 0.18
+ PTF = 0
+ CJC = 2.96E-012
+ VJC = 0.4591
+ MJC = 0.2956
+ XCJC = 1
+ TR = 8.7E-008
+ CJS = 0
+ VJS = 0.75
+ MJS = 0.333
+ FC = 0.78
.MODEL DIODE D
+ IS = 1.077E-015
+ N = 0.988
+ BV = 1000
+ IBV = 0.001
+ RS = 857.2
+ CJO = 0
+ VJ = 1
+ M = 0.5
+ FC = 0
+ TT = 0
+ EG = 1.11
+ XTI = 3
.ENDS
*^^^^^^^^  End of included SPICE model from PDTC114EU.cir ^^^^^^^^
*
*vvvvvvvv  Included SPICE model from LM393.cir vvvvvvvv
* LM393 VOLTAGE COMPARATOR "MACROMODEL" SUBCIRCUIT
* CREATED USING PARTS VERSION 4.03 ON 03/07/90 AT 14:17
* REV (N/A)
* CONNECTIONS:   NON-INVERTING INPUT
*                | INVERTING INPUT
*                | | POSITIVE POWER SUPPLY
*                | | | NEGATIVE POWER SUPPLY
*                | | | | OPEN COLLECTOR OUTPUT
*                | | | | |
.SUBCKT LM393    1 2 3 4 5
*
  F1    9  3 V1 1
  IEE   3  7 DC 100.0E-6
  VI1  21  1 DC .75
  VI2  22  2 DC .75
  Q1    9 21  7 QIN
  Q2    8 22  7 QIN
  Q3    9  8  4 QMO
  Q4    8  8  4 QMI
.MODEL QIN PNP(IS=800.0E-18 BF=2.000E3)
.MODEL QMI NPN(IS=800.0E-18 BF=1002)
.MODEL QMO NPN(IS=800.0E-18 BF=1000 CJC=1E-15 TR=807.4E-9)
  E1   10  4  9  4  1
  V1   10 11 DC 0
  Q5    5 11  4 QOC
.MODEL QOC NPN(IS=800.0E-18 BF=20.29E3 CJC=1E-15 TF=942.6E-12 TR=543.8E-9)
  DP    4  3 DX
  RP 3  4 46.3E3
.MODEL DX  D(IS=800.0E-18)
*
.ENDS
*^^^^^^^^  End of included SPICE model from LM393.cir ^^^^^^^^
*
*vvvvvvvv  Included SPICE model from TS912.cir vvvvvvvv
** Standard Linear Ics Macromodels, 1993.
** CONNECTIONS :
* 1 NON-INVERTING INPUT
* 2 INVERTING INPUT
* 3 POSITIVE POWER SUPPLY
* 4 NEGATIVE POWER SUPPLY
* 5 OUTPUT
.SUBCKT TS912 2 1 4 5 3
**********************************************************
.MODEL MDTH D IS=1E-8 KF=6.563355E-14 CJO=10F
* INPUT STAGE
CIP 2 5 1.500000E-12
CIN 1 5 1.500000E-12
EIP 10 5 2 5 1
EIN 16 5 1 5 1
RIP 10 11 6.500000E+00
RIN 15 16 6.500000E+00
RIS 11 15 7.655100E+00
DIP 11 12 MDTH 400E-12
DIN 15 14 MDTH 400E-12
VOFP 12 13 DC 0.000000E+00
VOFN 13 14 DC 0
IPOL 13 5 4.000000E-05
CPS 11 15 3.82E-08
DINN 17 13 MDTH 400E-12
VIN 17 5 -0.5000000e+00
DINR 15 18 MDTH 400E-12
VIP 4 18 -0.5000000E+00
FCP 4 5 VOFP 7.750000E+00
FCN 5 4 VOFN 7.750000E+00
* AMPLIFYING STAGE
FIP 5 19 VOFP 5.500000E+02
FIN 5 19 VOFN 5.500000E+02
RG1 19 5 5.087344E+05
RG2 19 4 5.087344E+05
CC 19 29 2.200000E-08
HZTP 30 29 VOFP 12.33E+02
HZTN  5 30 VOFN 12.33E+02
DOPM 19 22 MDTH 400E-12
DONM 21 19 MDTH 400E-12
HOPM 22 28 VOUT 3135
VIPM 28 4 150
HONM 21 27 VOUT 3135
VINM 5 27 150
EOUT 26 23 19 5 1
VOUT 23 5 0
ROUT 26 3 65
COUT 3 5 1.000000E-12
DOP 19 68 MDTH 400E-12
VOP 4 25 1.924
HSCP 68 25 VSCP1 1E8
DON 69 19 MDTH 400E-12
VON 24 5 2.4419107
HSCN 24 69 VSCN1 1.5E8
VSCTHP 60 61 0.1375
DSCP1 61 63 MDTH 400E-12
VSCP1 63 64 0
ISCP 64 0 1.000000E-8
DSCP2 0 64 MDTH 400E-12
DSCN2 0 74 MDTH 400E-12
ISCN 74 0 1.000000E-8
VSCN1 73 74 0
DSCN1 71 73 MDTH 400E-12
VSCTHN 71 70 -0.75
ESCP 60 0 2 1 500
ESCN 70 0 2 1 -2000
.ENDS
*^^^^^^^^  End of included SPICE model from TS912.cir ^^^^^^^^
*
*vvvvvvvv  Included SPICE model from BC817.cir vvvvvvvv
*
**********************************************************
*
* BC817
*
* NXP Semiconductors
*
* General purpose NPN transistor
* IC   = 500 mA
* VCEO = 45 V 
* hFE  = 100 - 600 @ 1V/100mA
* 
*
*
*
* Package pinning does not match Spice model pinning.
* Package: SOT 23
* 
* Package Pin 1: Base
* Package Pin 2: Emitter
* Package Pin 3: Collector
* 
*
* 
* Simulator: Spice 2        
*
**********************************************************
*# 
.MODEL QBC817 NPN
+    IS = 9.198E-14
+    NF = 1.003
+    ISE = 4.468E-16
+    NE = 1.65
+    BF = 338.8 
+    IKF = 0.4913
+    VAF = 107.9
+    NR = 1.002
+    ISC = 5.109E-15
+    NC = 1.071 
+    BR = 29.48
+    IKR = 0.193
+    VAR = 25
+    RB = 1
+    IRB = 1000
+    RBM = 1 
+    RE = 0.2126
+    RC = 0.143
+    XTB = 0
+    EG = 1.11
+    XTI = 3
+    CJE = 3.825E-11 
+    VJE = 0.7004
+    MJE = 0.364
+    TF = 5.229E-10
+    XTF = 219.7
+    VTF = 3.502 
+    ITF = 7.257
+    PTF = 0
+    CJC = 1.27E-11
+    VJC = 0.4431
+    MJC = 0.3983 
+    XCJC = 0.4555
+    TR = 7E-11
+    CJS = 0
+    VJS = 0.75
+    MJS = 0.333
+    FC = 0.905
*## 
*
*^^^^^^^^  End of included SPICE model from BC817.cir ^^^^^^^^
*
*==============  Begin SPICE netlist of main design ============
R8 2 gate 100k  
Q1 1 2 gate QBC817 
Vsw sw 0 PULSE 0 5 1ms 100n 100n 0.5ms 50ms
.MODEL SW VSWITCH(VON=5V VOFF=0V RON=0.1 ROFF=1meg)
R18 7 out 200k  
S1 7 0 sw 0 sw 
C22 0 5 10n  
C20 DIFF_OUT 6 10n  
Vcset cset 0 DC 0.5
R4 DIFF_OUT 6 75k  
R2 0 5 75k  
XU2 5 6 VCC 0 DIFF_OUT TS912
Vout 4 1 DC 0V
R5 OCPROT# VCC 10k  
XU4 cset DIFF_OUT VCC 0 OCPROT# LM393
R3 6 4 1.2k  
R1 5 VCC 1.2k  
Rcs VCC 4 180m  
V2 VCC 0 DC 7V
XT2 3 ctrl 0 PDTC114EU
R10 0 out 5.6k  
C2 0 out 2.2u  
Vctrl ctrl 0 PULSE 0 3.3 1ms 100n 100n 100ms 200ms
C1 gate 1 0.22u  
R9 3 2 47k  
R7 2 1 47k  
XT1 out gate 1 IRLML9301
.OPTIONS ABSTOL=10nA VNTOL=1uV CHGTOL=1pC ITL1=150 ITL2=150 ITL4=500 RELTOL=0.01

.CONTROL
  *OP
  TRAN 10u 200ms
  PLOT V(ctrl) V(out) V(gate) I(Vout) V(DIFF_OUT) V(OCPROT#)
  MEAS tran I_surge MAX i(Vout) from=1m to=100m
  MEAS tran t_on TRIG v(ctrl) VAL=1 RISE=1 TARG v(out) VAL=6.3 RISE=1
  MEAS tran t_rise TRIG v(out) VAL=0.7 RISE=1 TARG v(out) VAL=6.3 RISE=1
.ENDC

.end
